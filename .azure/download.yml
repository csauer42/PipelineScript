parameters:
- name: sampleVersion
  type: string
  default: ''
- name: mainVersion
  type: string
  default: ''
- name: avrVersion
  type: string
  default: ''  
- name: pkgFeed
  type: string
  default: '477fc493-2c12-4877-954a-3040372f2485/40809f3d-1cfb-45c7-b7e3-589968369bc9'

steps:
- bash: echo 'mainVersion = ${{ parameters.sampleVersion }}'
- task: UniversalPackages@0
  condition: ne('${{ parameters.sampleVersion }}', '')
  inputs:
    command: 'download'
    downloadDirectory: '$(Build.ArtifactStagingDirectory)'
    feedsToUse: 'internal'
    vstsFeed: ${{ parameters.pkgFeed }}
    vstsFeedPackage: 'sample.bin'
    vstsPackageVersion: '${{ parameters.sampleVersion }}'
- bash: echo 'mainVersion = ${{ parameters.mainVersion }}'
- task: UniversalPackages@0
  condition: and(succeeded(), ne('${{ parameters.mainVersion }}', ''))
  inputs:
    command: 'download'
    downloadDirectory: '$(Build.ArtifactStagingDirectory)'
    feedsToUse: 'internal'
    vstsFeed: ${{ parameters.pkgFeed }}
    vstsFeedPackage: 'main.hex'
    vstsPackageVersion: '${{ parameters.mainVersion }}'
- bash: echo 'mainVersion = ${{ parameters.avrVersion }}'
- task: UniversalPackages@0
  condition: ne('${{ parameters.avrVersion }}', '')
  inputs:
    command: 'download'
    downloadDirectory: '$(Build.ArtifactStagingDirectory)'
    feedsToUse: 'internal'
    vstsFeed: ${{ parameters.pkgFeed }}
    vstsFeedPackage: 'avr-common'
    vstsPackageVersion: '${{ parameters.avrVersion }}'